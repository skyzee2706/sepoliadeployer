<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deploy Token (Real Bytecode)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script>tailwind.config = { theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] } } } }</script>
    <style>
        body { background-color: #020617; color: #e2e8f0; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; background: #0f172a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- MODAL -->
    <div id="walletModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-md p-4 shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-white">Pilih Wallet</h3>
                <button onclick="toggleModal(false)" class="text-slate-400"><i data-lucide="x"></i></button>
            </div>
            <div class="space-y-3">
                <button onclick="connectProvider('metamask')" class="w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-700 transition-all text-white font-bold">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" class="w-6 h-6"> MetaMask
                </button>
                <button onclick="connectProvider('okx')" class="w-full flex items-center gap-3 p-3 bg-slate-800 hover:bg-slate-700 rounded-xl border border-slate-700 transition-all text-white font-bold">
                    <div class="w-6 h-6 bg-white rounded-full text-black text-[8px] flex items-center justify-center font-black">OKX</div> OKX Wallet
                </button>
            </div>
        </div>
    </div>

    <!-- NAV -->
    <header class="h-16 border-b border-slate-800 bg-slate-950/80 backdrop-blur flex items-center justify-between px-6 sticky top-0 z-40">
        <div class="flex items-center gap-2 font-bold text-lg">
            <i data-lucide="layers" class="text-blue-500"></i> EVM<span class="text-blue-400">Deployer</span>
        </div>
        <div class="flex gap-3">
            <select id="networkSelect" onchange="handleNetworkChange()" class="bg-slate-900 border border-slate-700 text-xs rounded px-3 py-2 outline-none hidden md:block">
                <option value="0xaa36a7">Sepolia</option>
                <option value="0x14a34">Base Sepolia</option>
                <option value="0x1">Ethereum Mainnet</option>
                <option value="0x38">BNB Chain</option>
                <option value="0x2105">Base Mainnet</option>
            </select>
            <button id="btnConnect" onclick="toggleModal(true)" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-bold transition-all shadow-lg shadow-blue-900/20">Connect Wallet</button>
        </div>
    </header>

    <!-- MAIN -->
    <main class="flex-1 max-w-6xl mx-auto w-full p-6 grid md:grid-cols-2 gap-8">
        
        <!-- FORM -->
        <div class="space-y-6">
            <div class="bg-slate-900 border border-slate-700 rounded-2xl p-6 shadow-xl relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-purple-500"></div>
                <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2"><i data-lucide="rocket" class="text-blue-500"></i> Token Config</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Name</label>
                        <input id="inputName" class="w-full bg-black/50 border border-slate-700 rounded-lg p-3 text-white focus:border-blue-500 outline-none mt-1" placeholder="e.g. Gold Token">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Symbol</label>
                        <input id="inputSymbol" class="w-full bg-black/50 border border-slate-700 rounded-lg p-3 text-white focus:border-blue-500 outline-none mt-1" placeholder="e.g. GOLD">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Supply</label>
                        <div class="relative">
                            <input id="inputSupply" type="number" value="1000000" class="w-full bg-black/50 border border-slate-700 rounded-lg p-3 text-white focus:border-blue-500 outline-none mt-1 font-mono">
                            <span class="absolute right-4 top-4 text-xs text-slate-500">TOKENS</span>
                        </div>
                    </div>
                    
                    <div class="p-3 bg-blue-900/20 border border-blue-500/30 rounded text-[10px] text-blue-200 flex gap-2">
                        <i data-lucide="info" class="w-4 h-4 shrink-0"></i>
                        <p>Bytecode ERC-20 Standar telah dimuat. Token akan otomatis masuk ke wallet Anda setelah deploy.</p>
                    </div>

                    <button id="btnDeploy" onclick="deployToken()" disabled class="w-full py-4 rounded-xl font-bold bg-slate-800 text-slate-500 cursor-not-allowed mt-2 transition-all">Connect Wallet First</button>
                </div>
            </div>
        </div>

        <!-- LOGS -->
        <div class="flex flex-col gap-4 h-full">
            <div id="successCard" class="hidden bg-green-900/20 border border-green-500/30 rounded-xl p-5 animate-in fade-in slide-in-from-bottom-4">
                <div class="flex items-center gap-3 mb-2">
                    <div class="bg-green-500 p-1 rounded-full"><i data-lucide="check" class="text-white w-4 h-4"></i></div>
                    <h3 class="font-bold text-white">Deployment Berhasil!</h3>
                </div>
                <p class="text-xs text-slate-400 mb-3">Kontrak aktif. Saldo token telah ditambahkan ke wallet owner.</p>
                <div class="bg-black/30 p-2 rounded border border-green-500/20 flex justify-between items-center mb-3">
                    <code id="deployedAddress" class="text-green-400 font-mono text-xs truncate">0x...</code>
                    <button onclick="navigator.clipboard.writeText(document.getElementById('deployedAddress').innerText)" class="text-slate-400 hover:text-white text-xs">Copy</button>
                </div>
                <a id="etherscanLink" href="#" target="_blank" class="block text-center bg-green-600 hover:bg-green-500 text-white py-2 rounded text-xs font-bold transition-colors">Lihat di Explorer</a>
            </div>

            <div class="bg-slate-900 border border-slate-700 rounded-xl flex-1 flex flex-col overflow-hidden min-h-[300px]">
                <div class="p-3 border-b border-slate-800 bg-slate-950 text-xs font-bold text-slate-400 uppercase flex gap-2 items-center">
                    <i data-lucide="terminal" class="w-4 h-4"></i> Console Logs
                </div>
                <div id="logsArea" class="flex-1 p-4 font-mono text-[11px] overflow-y-auto space-y-1 custom-scrollbar">
                    <div class="text-slate-600 text-center mt-10">System Ready.</div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // --- DATA & CONFIG ---
        const NETWORKS = {
            "0xaa36a7": { name: "Sepolia", explorer: "https://sepolia.etherscan.io", rpc: ["https://rpc.sepolia.org"] },
            "0x14a34": { name: "Base Sepolia", explorer: "https://sepolia.basescan.org", rpc: ["https://sepolia.base.org"] },
            "0x1": { name: "Ethereum", explorer: "https://etherscan.io", rpc: ["https://eth.llamarpc.com"] },
            "0x38": { name: "BNB Chain", explorer: "https://bscscan.com", rpc: ["https://bsc-dataseed.binance.org/"] },
            "0x2105": { name: "Base", explorer: "https://basescan.org", rpc: ["https://mainnet.base.org"] }
        };

        let provider, signer, userAddress, currentChainId = "0xaa36a7";

        // --- REAL ERC20 BYTECODE (Solidity 0.8.17) ---
        // Ini adalah bytecode HEX yang SANGAT PENTING. Jangan dihapus.
        // Kontrak ini menerima 3 argumen: string name, string symbol, uint256 supply
        // Dan melakukan _mint(msg.sender, supply) di constructor.
        const STANDARD_ABI = [
            "constructor(string name, string symbol, uint256 initialSupply)",
            "function name() view returns (string)",
            "function symbol() view returns (string)",
            "function totalSupply() view returns (uint256)",
            "function balanceOf(address) view returns (uint256)",
            "function transfer(address to, uint256 value) returns (bool)"
        ];

        // Bytecode dari kontrak SimpleToken.sol (Standard ERC20)
        const BYTECODE_BASE = "";

        // --- LOGIC ---
        function addLog(msg, type='info') {
            const area = document.getElementById('logsArea');
            if(area.innerText.includes('System Ready')) area.innerHTML = '';
            const div = document.createElement('div');
            const color = type==='error'?'text-red-400':(type==='success'?'text-green-400':'text-slate-300');
            div.innerHTML = `<span class="text-slate-600 mr-2">[${new Date().toLocaleTimeString()}]</span><span class="${color}">${msg}</span>`;
            area.appendChild(div);
            area.scrollTop = area.scrollHeight;
        }

        function toggleModal(show) {
            const m = document.getElementById('walletModal');
            if(show) { m.classList.remove('hidden'); setTimeout(()=>m.classList.remove('opacity-0'),10); }
            else { m.classList.add('opacity-0'); setTimeout(()=>m.classList.add('hidden'),300); }
        }

        async function connectProvider(t) {
            toggleModal(false);
            try {
                let raw = t==='okx' ? window.okxwallet : window.ethereum;
                if(!raw) throw new Error(`${t} not found`);
                
                provider = new ethers.BrowserProvider(raw);
                const acc = await provider.send("eth_requestAccounts", []);
                signer = await provider.getSigner();
                userAddress = acc[0];

                document.getElementById('btnConnect').innerText = userAddress.substring(0,6)+"...";
                const btn = document.getElementById('btnDeploy');
                btn.disabled = false;
                btn.innerText = "DEPLOY TOKEN SEKARANG ðŸš€";
                btn.className = "w-full py-4 rounded-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:scale-[1.02] transition-all shadow-lg";
                
                addLog("Wallet Connected: " + userAddress, "success");
                handleNetworkChange();
            } catch(e) { addLog(e.message, "error"); }
        }

        async function handleNetworkChange() {
            currentChainId = document.getElementById('networkSelect').value;
            if(!provider) return;
            try {
                await provider.send("wallet_switchEthereumChain", [{ chainId: currentChainId }]);
                addLog("Network switched", "success");
            } catch(e) {
                if(e.code === 4902) {
                    const net = NETWORKS[currentChainId];
                    try {
                        await provider.send("wallet_addEthereumChain", [{
                            chainId: currentChainId,
                            chainName: net.name,
                            rpcUrls: net.rpc,
                            nativeCurrency: { name:"ETH", symbol:"ETH", decimals:18 },
                            blockExplorerUrls: [net.explorer]
                        }]);
                    } catch(addErr) { addLog("Add Network Fail: " + addErr.message, "error"); }
                }
            }
        }

        async function deployToken() {
            const name = document.getElementById('inputName').value;
            const symbol = document.getElementById('inputSymbol').value;
            const supply = document.getElementById('inputSupply').value;

            if(!name || !symbol || !supply) return addLog("Isi semua data!", "error");

            const btn = document.getElementById('btnDeploy');
            btn.disabled = true;
            btn.innerText = "Processing...";

            try {
                addLog(`Menyiapkan Deployment: ${name} (${symbol})...`);
                const factory = new ethers.ContractFactory(STANDARD_ABI, BYTECODE_BASE, signer);
                const supplyWei = ethers.parseUnits(supply, 18);

                // 1. FORCE MANUAL GAS LIMIT (Solusi "Missing Revert Data")
                // Kita memberi gas limit besar (3jt) agar node tidak menolak simulasi.
                const deployTx = await factory.getDeployTransaction(name, symbol, supplyWei);
                
                addLog("Mengirim Transaksi ke Blockchain...", "warning");
                const tx = await signer.sendTransaction({
                    data: deployTx.data,
                    gasLimit: 3000000 // Hardcoded safety gas
                });

                addLog(`Tx Terkirim! Hash: ${tx.hash}`, "info");
                addLog("Menunggu konfirmasi (Mining)...");

                const receipt = await tx.wait();
                
                if (receipt.status === 1) {
                    const addr = receipt.contractAddress;
                    document.getElementById('deployedAddress').innerText = addr;
                    document.getElementById('etherscanLink').href = `${NETWORKS[currentChainId].explorer}/address/${addr}`;
                    document.getElementById('successCard').classList.remove('hidden');
                    addLog(`âœ… SUKSES! Token Address: ${addr}`, "success");
                    
                    // Auto add to metamask prompt
                    try {
                        await window.ethereum.request({
                            method: 'wallet_watchAsset',
                            params: {
                                type: 'ERC20',
                                options: { address: addr, symbol: symbol, decimals: 18 },
                            },
                        });
                    } catch (e) {}
                } else {
                    throw new Error("Transaksi gagal di-mine (Reverted)");
                }

            } catch(e) {
                console.error(e);
                addLog("Gagal: " + (e.reason || e.message), "error");
            } finally {
                btn.disabled = false;
                btn.innerText = "DEPLOY TOKEN SEKARANG ðŸš€";
            }
        }

        lucide.createIcons();
    </script>
</body>
</html>


